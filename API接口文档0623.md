# 数据处理系统 API 接口文档
## 概述
本文档描述了数据处理系统的API接口规范，系统支持三种主要操作类型：数据展示、统计分析和可视化。

## 通用响应格式
单步任务（如数据展示/统计分析/可视化单独一个功能）：

```json
{
  "code": "响应状态码",
  "message": "响应消息",
  "data": {
    "operation_type": "操作类型",
    "title": "标题描述",
    "result": "详细数据",
    "type": "图表类型",   // 仅可视化有
    "source": "py文件路径" // 仅统计分析有
  }
}
```

多步任务（如统计分析+可视化一起）：

```json
{
  "code": "响应状态码",
  "message": "多步任务执行全部成功",
  "data": {
    "results": [
      {
        "operation_type": "操作类型",
        "message": "子任务提示信息",
        "title": "标题描述",
        "result": [ ... ], // 统计结果/可视化数据
        "type": "图表类型",   // 仅可视化有
        "source": "py文件路径" // 仅统计分析有
      }
      // ...如有多个步骤，后续对象依次添加
    ]
  }
}
```

---

### 字段说明
| 字段名 | 说明 |
| --- | --- |
| code | 200:成功，400:参数错误，500:服务器错误 |
| message | 响应整体提示，如“数据获取成功”、“多步任务执行全部成功”等 |
| data | 见上：单步为对象，多步为{ "results": [ ... ] } |
| operation_type | data_display/statistical_analysis/visualization |
| title | 数据/统计/图表的标题描述 |
| result | 返回的数组或Json对象（详见各类型范例） |
| message（results内） | 单步子任务的成功提示 eg:“统计分析已完成” |
| type | 图表类型：bar/line/pie/scatter等 |
| source | 生成的Python脚本路径 |


---

### 1. 数据展示（data_display）
#### 说明
返回完整数据集内容。

#### 响应示例
```json
{
  "code": "200",
  "message": "数据获取成功",
  "data": {
    "operation_type": "data_display",
    "title": "河北省各地市停电计划数",
    "result": [
      {"单位编码": "13414", "地市": "雄安",      "数量": 8},
      {"单位编码": "13405", "地市": "邢台",      "数量": 100},
      {"单位编码": "13401", "地市": "石家庄",    "数量": 182},
      {"单位编码": "13404", "地市": "衡水",      "数量": 103}
      // ...更多
    ]
  }
}
```

### 2. 统计分析（statistical_analysis）
#### 说明
对数据集进行汇总、合并、占比等统计。

#### 响应示例（单步分析）
```json
{
  "code": "200",
  "message": "统计分析已完成",
  "data": {
    "operation_type": "statistical_analysis",
    "title": "按地市和单位编码合并数据集",
    "result": [
      {"单位编码": "13401", "地市": "石家庄", "数量_作业": 182, "数量_停电": 84},
      {"单位编码": "13404", "地市": "衡水",   "数量_作业": 103, "数量_停电": 58}
      // ...更多
    ],
    "source": "data_agent_outputs/generated_code_20250623_161219.py"
  }
}
```

### 3. 可视化（visualization）
#### 说明
返回可直接用于前端渲染的可视化数据对象及类型。

#### 响应示例（单步柱状图）
```json
{
  "code": "200",
  "message": "可视化数据已准备好",
  "data": {
    "operation_type": "visualization",
    "title": "各地市作业计划数排序",
    "result": [
      {"单位编码": "13406", "地市": "保定",  "数量_作业": 237, "数量_停电": 100},
      {"单位编码": "13401", "地市": "石家庄", "数量_作业": 182, "数量_停电": 84}
      // ...更多
    ],
    "type": "bar"
  }
}
```

### 4. 多步任务复合响应（统计分析+可视化）
#### 说明
一条请求返回多个分析/可视化步骤结果。

#### 响应示例
```json
{
  "code": "200",
  "message": "多步任务执行全部成功",
  "data": {
    "results": [
      {
        "message": "统计分析已完成",
        "operation_type": "statistical_analysis",
        "title": "各地市作业计划数排序",
        "result": [
          {"单位编码": "13406", "地市": "保定",     "数量_作业": 237, "数量_停电": 100},
          {"单位编码": "13401", "地市": "石家庄",   "数量_作业": 182, "数量_停电": 84}
          // ...更多
        ],
        "source": "data_agent_outputs/generated_code_20250623_161255.py"
      },
      {
        "message": "可视化数据已准备好",
        "operation_type": "visualization",
        "title": "各地市作业计划数排序",
        "result": [
          {"单位编码": "13406", "地市": "保定", "数量_作业": 237},
          {"单位编码": "13401", "地市": "石家庄", "数量_作业": 182}
          // ...更多
        ],
        "type": "bar"
      }
    ]
  }
}
```

### 5. 错误响应
#### 参数错误
```json
{
  "code": "400",
  "message": "请求参数错误：缺少必要的数据文件路径",
  "data": {
    "operation_type": null
  }
}
```

#### 服务器错误
```json
{
  "code": "500",
  "message": "服务器内部错误：数据处理失败",
  "data": {
    "operation_type": null
  }
}
```

